"use client"

import { notFound } from "next/navigation"

import { JobDataCard } from "@/components/detection/job-data-card"
import { JobStatusScanJobCard } from "@/components/detection/job-status-scan-job-card"
import { PageTitle } from "@/components/shared/animations/page-header"
import { IStatusScanJob } from "@/types/workers-status/status-scan-job"

import { useStatusScanJob } from "@/hooks/use-status-scan-job"

const JobPage = ({ params }: { params: { id: string } }) => {
  const { statusScanJob, isError, error, isLoading } = useStatusScanJob({ dbJobId: params.id })
  
  const renderJobSection = (statusScanJob: IStatusScanJob) => {
    return (
      <div className="grid gap-4 md:grid-cols-2">
        <JobDataCard job={statusScanJob.job} />
        <JobStatusScanJobCard statusScanJob={statusScanJob} />
      </div>
    )
  }

  if (isError) return (
    notFound()
  )

  if (!isLoading && statusScanJob !== undefined) {
    return (
      <div className="space-y-4">
        <PageTitle 
          title={`Job ${params.id}`}
          loadingTitle="Job"
          isLoading={isLoading}
        />
        {renderJobSection(statusScanJob)}
      </div>
    )
  }

  return (
    <PageTitle 
      title={`Job ${params.id}`}
      loadingTitle="Job"
      isLoading={isLoading}
    />
  )
}

export default JobPage
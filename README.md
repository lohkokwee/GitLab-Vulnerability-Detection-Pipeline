
# VDV2

Repository for IS607 Vulnerability Discovery Dashboard Server.

## Development Environment Set-up
Follow the steps below to get a server running locally.

1. Create a [Python virtual environment](https://realpython.com/python-virtual-environments-a-primer/).

2. Install requirements from the [backend](./backend) sub-directory.
```
pip install -r requirements. txt
```

3. Install PostgreSQL on your local machine. 

4. Create a new `.env` file from `.env.example`. Here is a list of the basic changes required:
    - `DATABASE_USER`
    - `DATABASE_PASSWORD`
    - `DATABASE_NAME`
    - `GITLAB_ACCESS_TOKEN` _If an old access token is used, you will not be able to retrieve the relevant files. Create an access token by clicking your GitLab profile icon > `Access Tokens` > `Add new token`._

> Note: you should instantiate a database, either through the CLI (`createdb <DATABASE_NAME> -O <DATABASE_USER>`) or through a GUI, before running the migrations.

5. Run migrations with alembic from the [root folder](./backend/) to update the database.
```
alembic upgrade head
```

6. Start server by running [main.py](./backend/app/main.py) from within `/backend/app`.
```
fastapi dev main.py
```

## Building with Docker-compose
After changing relevant `.env` variables in step 5 of the [Development Environment Set-up](#development-environment-set-up), runing the docker-compose scripts will either build or rebuild the server and database, running all migrations as well.

```
docker compose up

# or

docker-compose up --build
```

> Note: to remove volumes during a compose shutdown, run `docker-compose down --volumes`. Required if you run into an error stating volumes have already been initialised.

## Testing

### Unit Tests
We make use of `pytest` to carry out our unit tests. Run the `pytest` command from the [base directory](backend/) to begin testing the test suite.

<!-- ### Load Tests
We conduct load tests with [locust](https://locust.io/). All load testing files can be found in `backend/tests/load`.

To run the load tests, navigate to `/backend` and run `locust -f tests/load`. Click the generated link and use the GUI to configure your desired tests. -->

## Testing with GitLab
To conduct tests with GitLab from our local servers, we need to expose our local server through a proxy. We can make use of [ngrok](https://ngrok.com/) for this.

1. Run the server locally as per steps outlined above.

2. Expose the server through the ngrok proxy.
```
ngrok http http://127.0.0.1:8000
```

3. Change respective links `.gitlab-ci.yml` file in the target repository.

4. Pushing new commits to the target repository should trigger an API call to our local servers through the ngrok proxy.
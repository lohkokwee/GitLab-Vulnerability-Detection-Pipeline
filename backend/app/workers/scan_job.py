from app.database.db import SessionLocal
from app.database.crud.detection import get_job_by_db_job_id
from app.internal.gitlab import get_related_files

async def start(
  db_job_id: int
):
  db = SessionLocal()
  db_job, success, files = None, False, None

  try:
    db_job = get_job_by_db_job_id(db=db, db_job_id=db_job_id) 
  finally:
    db.close()
  
  if db_job:
    success, files = await get_related_files(
      gl_project_id=db_job.gl_project_id,
      gl_commit_sha=db_job.gl_commit_sha,
      diff=db_job.diff
    )
  if success:
    ... # TODO: model scans files here
  

  # TODO: add job trigger here

  
  